
%% ========================
% 逆变器参数（Inverter Parameters）
% ========================
V_dc = 500;          % 直流母线电压（单位：V）
f_sw = 10e3;         % 逆变器开关频率（单位：Hz）
T_sw = 1 / f_sw;     % 开关周期（单位：s）
k_xyz = sqrt(3) * T_sw / V_dc;  % 一个与调制器相关的系数（用于电压换算）

%% ========================
% 异步电机参数（Induction Motor Parameters）
% ========================
P_n = 3000;           % 电机额定功率（单位：W）
V_n = 380;            % 电机额定线电压有效值（单位：V）
I_n = 6.9;            % 电机额定电流（单位：A）
f_n = 50;             % 电机额定频率（单位：Hz）
w_n = 2 * pi * f_n;   % 电机额定电气角频率（单位：rad/s）

rpm_n = 1400;         % 电机额定机械转速（单位：rpm）
n_p = 2;              % 电机极对数（Pole pairs）

V_max = V_n * sqrt(2) / sqrt(3); % 相电压最大幅值（单位：V）

rpm_syn = 60 * f_n / n_p;        % 同步转速（单位：rpm）
w_syn = rpm_syn * pi / 30;       % 同步角速度（单位：rad/s）

s_n = (rpm_syn - rpm_n) / rpm_syn;  % 额定转差率（Slip ratio）

% 电机电阻与电感参数
R_s = 1.85;         % 定子电阻（单位：Ω）
R_r = 2.658;        % 转子电阻（单位：Ω）
L_m = 1*0.2838;       % 励磁电感（单位：H），注：约等于1.5倍互感

L_ls = 0.294-0.2838;       % 定子漏感（单位：H）
L_lr = 0.2898-0.2838;      % 转子漏感（单位：H）

L_s = L_m + L_ls;   % 定子总电感（单位：H）
L_r = L_m + L_lr;   % 转子总电感（单位：H）

sigma = 1 - L_m^2 / (L_s * L_r);  % 总漏磁系数（Leakage coefficient）

R = R_s + R_r * (L_m/L_r)^2;      % 用于电流环设计的等效电阻（单位：Ω）
L = sigma * L_s;                  % 用于电流环设计的等效电感（单位：H）

T_r = L_r / R_r;   % 转子时间常数（单位：s）

% 电机额定运行点计算
Te_n = n_p * P_n / (w_syn * (1 - s_n));  % 额定电磁转矩（单位：N·m）

Ids_n = V_max / sqrt(R_s^2 + (w_n * L_s)^2);  % 额定d轴电流（单位：A）
flux_n = L_m * Ids_n;                         % 额定励磁磁链（单位：Wb）

k_t = 1.5 * n_p * L_m^2 * Ids_n / L_r;        % 转矩常数，用于计算q轴电流

Iqs_n = Te_n / k_t;             % 额定q轴电流（单位：A）
wsl_n = Iqs_n / (T_r * Ids_n); % 额定滑差角速度（单位：rad/s）

%% ========================
% 负载参数（Load Parameters）
% ========================
J = 0.1284;  % 负载转动惯量（单位：kg·m²）
B = 0;       % 负载摩擦阻尼系数，设为零（单位：N·m·s）

%% ========================
% 电流环 PI 参数（ACR: Current Loop PI Controller）
% ========================
wc_i = 0.0707 * f_sw * 2 * pi;  % 电流环截止频率（单位：rad/s），通常设置为开关频率的1/10左右
kp_i = L * wc_i;                % 电流环比例增益
ki_i = R * wc_i;                % 电流环积分增益
ka_i = 1 / kp_i;                % 电流前馈增益（解耦控制用）

%% ========================
% 速度环 PI 参数（ASR: Speed Loop PI Controller）
% ========================
wc_s = wc_i / 5;                % 速度环截止频率，比电流环低5倍
kp_s = J * wc_s / k_t;          % 速度环比例增益
ki_s = kp_s * wc_s / 5;         % 速度环积分增益
ka_s = 1 / kp_s;                % 转矩前馈增益（用于加快响应）

